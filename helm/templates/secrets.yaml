{{/*
Copyright 2025 Tencent
SPDX-License-Identifier: MIT

Secrets for WeKnora components.

IMPORTANT: For production deployments, use one of these approaches:
1. Set values via --set flags during installation
2. Use External Secrets Operator with cloud secret managers
3. Use sealed-secrets for GitOps workflows
4. Provide an existing secret via secrets.existingSecret
*/}}
{{- if not .Values.secrets.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "weknora.secretName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "weknora.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Database credentials
  DB_USER: {{ .Values.secrets.dbUser | quote }}
  DB_PASSWORD: {{ required "secrets.dbPassword is required" .Values.secrets.dbPassword | quote }}
  DB_NAME: {{ .Values.secrets.dbName | quote }}
  # Redis credentials
  REDIS_USERNAME: {{ .Values.secrets.redisUsername | default "" | quote }}
  REDIS_PASSWORD: {{ required "secrets.redisPassword is required" .Values.secrets.redisPassword | quote }}
  # Application secrets
  JWT_SECRET: {{ required "secrets.jwtSecret is required" .Values.secrets.jwtSecret | quote }}
  TENANT_AES_KEY: {{ .Values.secrets.tenantAesKey | default (randAlphaNum 32) | quote }}
  {{- if .Values.neo4j.enabled }}
  # Neo4j credentials (for GraphRAG)
  NEO4J_USERNAME: {{ .Values.neo4j.username | quote }}
  NEO4J_PASSWORD: {{ required "neo4j.password is required when neo4j is enabled" .Values.neo4j.password | quote }}
  {{- end }}
{{- end }}
